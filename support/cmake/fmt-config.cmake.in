@PACKAGE_INIT@

if (NOT TARGET fmt::fmt)
  include(${CMAKE_CURRENT_LIST_DIR}/@targets_export_name@.cmake)
endif ()

check_required_components(fmt)

function(add_fmt_module NAME)
    set(FMT_ROOT @CMAKE_INSTALL_PREFIX@)
    #XXX set(FMT_ROOT @PROJECT_SOURCE_DIR@)
    message(STATUS "FMT_ROOT is: ${FMT_ROOT}")
    add_library(${NAME})
    target_include_directories(${NAME} PUBLIC ${FMT_ROOT}/include)
    target_compile_features(${NAME} PUBLIC cxx_std_23)
    target_compile_options(${NAME} PRIVATE -Wno-include-angled-in-module-purview
                                           -Wno-unknown-warning-option
    )

    #FIXME: target_compile_definitions(${NAME} PUBLIC FMT_MODULE FMT_ATTACH_TO_GLOBAL_MODULE)
    target_compile_definitions(${NAME} PUBLIC FMT_MODULE)

    if (DEFINED CPPdefinitions)
        target_compile_definitions(${NAME} PUBLIC ${CPPdefinitions})
    endif ()

    # cmake-format: off
    target_sources(${NAME} PUBLIC
        FILE_SET modules_public TYPE CXX_MODULES
            BASE_DIRS ${FMT_ROOT}
            FILES ${FMT_ROOT}/include/fmt/src/fmt.cc
            #XXX FILES ${FMT_ROOT}/src/fmt.cc
    )
    # cmake-format: on
endfunction()
